service--clip:
  handler: run.run
  module: modules/clip
  memorySize: 256
  timeout: 30
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.clip.name}-${self:custom.config.stage}
        batchSize: 1

service--media--postprocess:
  handler: run.run
  module: modules/media__postprocess
  memorySize: 128
  timeout: 30
  events:
    - cloudwatchEvent:
        event:
          source:
            - aws.mediaconvert
          detail:
            status:
              - COMPLETE
              - ERROR

service--montage:
  handler: run.run
  module: modules/montage
  memorySize: 256
  timeout: 30
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.montage.name}-${self:custom.config.stage}
        batchSize: 1

service--stream--analyze:
  handler: run.run
  module: modules/stream__analyze
  memorySize: 512
  timeout: 300
  reservedConcurrency: 5
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.stream--analyze.name}-${self:custom.config.stage}
        batchSize: 1

service--stream--initialize:
  handler: run.run
  module: modules/stream__initialize
  memorySize: 512
  timeout: 300
  reservedConcurrency: 5
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.stream--initialize.name}-${self:custom.config.stage}
        batchSize: 1
  package:
    individually: true
    include:
      - modules/stream__initialize/run.py
      - libs/ffprobe

service--stream-segment--analyze:
  handler: run.run
  module: modules/stream_segment__analyze
  memorySize: 1024
  timeout: 300
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.stream-segment--analyze.name}-${self:custom.config.stage}
        batchSize: 1
  package:
    individually: true
    include:
      - modules/stream_segment__analyze/run.py
      - libs/ffmpeg
      - libs/tesseract/**

service--stream-segment--download:
  handler: run.run
  module: modules/stream_segment__download
  memorySize: 1024
  timeout: 300
  events:
    - sqs:
        arn: arn:aws:sqs:${self:custom.config.region}:${self:custom.config.account-id}:${self:custom.config.sqs.queues.stream-segment--download.name}-${self:custom.config.stage}
        batchSize: 1
